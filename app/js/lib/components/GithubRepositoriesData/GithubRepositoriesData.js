'use strict';

//NPM Modules
import React from 'react';
import Transition from 'react-transition-group/Transition';
import { TweenMax } from 'gsap';
import DrawSVGPlugin from '../../vendor/gsap/DrawSVGPlugin';
import AttrPlugin from '../../vendor/gsap/AttrPlugin';

//Components
import GithubRepositoryEntry from './GithubRepositoryEntry/GithubRepositoryEntry';
//Store
import Store from './flux/store';

//Actions
import { setUserData, setRepositoriesData } from './flux/actions';

export default class GithubRepositoriesData extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      repositories: null,
      animate: false,
      entranceAnimationDuration : 20,
      loaderAnimationDuration: 1,
      loaderExited: false,
      loaderSuffix: ''
    };
    this.updateComponentState = this.updateComponentState.bind(this);
    this.transitionEnter = this.transitionEnter.bind(this);
    this.transitionEntering = this.transitionEntering.bind(this);
    this.transitionEntered = this.transitionEntered.bind(this);
    this.transitionExit = this.transitionExit.bind(this);
    this.transitionExiting = this.transitionExiting.bind(this);
    this.transitionExited = this.transitionExited.bind(this);
    this.startIntroAnimation = this.startIntroAnimation.bind(this);
    this.endLoaderAnimation = this.endLoaderAnimation.bind(this);
  }
  updateComponentState() {
    this.setState(Store.getState());
    if (this.state.loaderExited === false && this.state.repositories !== null) this.endLoaderAnimation();
  }
  componentDidMount() {
    if (this.state.repositories === null) this.startIntroAnimation();
    this.loaderSuffixAnimation = setInterval(() => {
      if (this.state.loaderSuffix.length < 3) {
        this.setState({ loaderSuffix: this.state.loaderSuffix + '.' });
      } else {
        this.setState({ loaderSuffix: '' });
      }
    }, 500);
    Store.on('change', this.updateComponentState);
  }
  componentWillUnmount() {
    Store.removeListener('change', this.updateComponentState);
  }
  transitionEnter() {
      TweenMax.fromTo(this.githubReposSvg, this.state.entranceAnimationDuration, { drawSVG: '0%', opacity: 1, ease: Linear.easeOut }, { drawSVG: '100%', opacity: 1, ease: Linear.easeOut });
      TweenMax.to(this.githubReposSvg, this.state.entranceAnimationDuration / 10, { delay: (this.state.entranceAnimationDuration / 10) / 4, attr: { fill: '#000000', stroke: '#FFFFFF' }, ease: Linear.easeOut });
      TweenMax.fromTo(this.loader, this.state.loaderAnimationDuration, { opacity: 0, onComplete: () => {
        setRepositoriesData();
      } }, { opacity: 1 });
  }
  transitionEntering() {}
  transitionEntered() {}
  transitionExit() {
    TweenMax.fromTo(this.loader, this.state.loaderAnimationDuration, { opacity: 1 }, { opacity: 0, onComplete: () => {
      clearInterval(this.loaderSuffixAnimation);
      this.setState({ loaderExited: true });
    } });
  }
  transitionExiting() {}
  transitionExited() {}
  startIntroAnimation() {
    this.setState({ animate: true });
  }
  endLoaderAnimation() {
    this.setState({ animate: false });
  }
  render() {
    let repositoryIndex = 0;
    let dots = '.';
    const repositoryEntries = this.state.repositories !== null && this.state.loaderExited ? this.state.repositories.map((repository) => {
      repositoryIndex++;
      return (
        <GithubRepositoryEntry key={repository.id.toString()} className="github-repository-entry" index={repositoryIndex} repository={repository}></GithubRepositoryEntry>
      );
    }) : (() => {
      return (
        <p className={'github-data-loader'} ref={c => this.loader = c}>loading{this.state.loaderSuffix}</p>
      );
    })();
    return (
      <Transition in={this.state.animate} timeout={{ enter: this.state.entranceAnimationDuration * 1000, exit: this.state.exitAnimationDuration * 1000 }} onEnter={this.transitionEnter} onEntering={this.transitionEntering} onEntered={this.transitionEntered} onExit={this.transitionExit} onExiting={this.transitionExiting} onExited={this.transitionExited} children={() => (
        <section id={this.props.id} ref={c => this.githubUserData = c}>
          <h2 className={'github-repositories-header'}>
            <svg xmlns={'http://www.w3.org/2000/svg'} xmlnsXlink={'http://www.w3.org/1999/xlink'} width={420.75} height={84.375} viewBox={'700 -15 50 150'} preserveAspectRatio={'xMaxYMax meet'} ><path ref={c => this.githubReposSvg = c} stroke={'black'} fill={'#FFFFFF'} strokeMiterlimit={'1'} strokeWidth={'1'} d={'M43.10 43.59L43.10 61.31L43.10 61.31Q41.17 63.98 36.32 65.74L36.32 65.74L36.32 65.74Q31.46 67.50 25.63 67.50L25.63 67.50L25.63 67.50Q19.93 67.50 15.47 64.72L15.47 64.72L15.47 64.72Q11.00 61.95 8.49 56.88L8.49 56.88L8.49 56.88Q5.98 51.82 5.91 45.42L5.91 45.42L5.91 36.63L5.91 36.63Q5.91 30.34 8.33 25.35L8.33 25.35L8.33 25.35Q10.76 20.36 15.15 17.63L15.15 17.63L15.15 17.63Q19.55 14.91 25.03 14.91L25.03 14.91L25.03 14.91Q32.66 14.91 37.46 18.81L37.46 18.81L37.46 18.81Q42.26 22.71 43.03 29.46L43.03 29.46L41.13 29.46L41.13 29.46Q40.18 23.34 36.04 20.07L36.04 20.07L36.04 20.07Q31.89 16.80 25.03 16.80L25.03 16.80L25.03 16.80Q17.30 16.80 12.55 22.32L12.55 22.32L12.55 22.32Q7.80 27.84 7.80 36.84L7.80 36.84L7.80 45L7.80 45Q7.80 51.01 10.04 55.72L10.04 55.72L10.04 55.72Q12.27 60.43 16.33 63.02L16.33 63.02L16.33 63.02Q20.39 65.60 25.63 65.60L25.63 65.60L25.63 65.60Q30.76 65.60 35.16 64.09L35.16 64.09L35.16 64.09Q39.55 62.58 41.20 60.43L41.20 60.43L41.20 45.53L25.56 45.53L25.56 43.59L43.10 43.59ZM57.83 28.76L57.83 66.80L55.93 66.80L55.93 28.76L57.83 28.76ZM54.95 16.88L54.95 16.88L54.95 16.88Q54.95 16.07 55.51 15.49L55.51 15.49L55.51 15.49Q56.07 14.91 56.88 14.91L56.88 14.91L56.88 14.91Q57.69 14.91 58.27 15.49L58.27 15.49L58.27 15.49Q58.85 16.07 58.85 16.88L58.85 16.88L58.85 16.88Q58.85 17.68 58.27 18.25L58.27 18.25L58.27 18.25Q57.69 18.81 56.88 18.81L56.88 18.81L56.88 18.81Q56.07 18.81 55.51 18.25L55.51 18.25L55.51 18.25Q54.95 17.68 54.95 16.88ZM72.63 18.49L74.57 18.49L74.57 28.76L83.21 28.76L83.21 30.69L74.57 30.69L74.57 57.69L74.57 57.69Q74.57 61.73 75.88 63.67L75.88 63.67L75.88 63.67Q77.20 65.60 80.30 65.60L80.30 65.60L80.30 65.60Q81.84 65.60 84.06 65.29L84.06 65.29L84.38 67.08L84.38 67.08Q83.21 67.50 80.40 67.50L80.40 67.50L80.40 67.50Q76.25 67.50 74.46 65.20L74.46 65.20L74.46 65.20Q72.67 62.89 72.63 57.94L72.63 57.94L72.63 30.69L65.60 30.69L65.60 28.76L72.63 28.76L72.63 18.49ZM94.99 12.80L94.99 37.62L94.99 37.62Q96.86 33.19 100.48 30.62L100.48 30.62L100.48 30.62Q104.10 28.05 108.49 28.05L108.49 28.05L108.49 28.05Q114.61 28.05 117.58 31.52L117.58 31.52L117.58 31.52Q120.55 34.98 120.59 41.98L120.59 41.98L120.59 66.80L118.69 66.80L118.69 41.91L118.69 41.91Q118.65 35.79 116.19 32.85L116.19 32.85L116.19 32.85Q113.73 29.92 108.39 29.92L108.39 29.92L108.39 29.92Q103.46 29.92 99.86 33.42L99.86 33.42L99.86 33.42Q96.26 36.91 94.99 42.43L94.99 42.43L94.99 66.80L93.09 66.80L93.09 12.80L94.99 12.80ZM159.93 66.80L157.99 66.80L157.99 60.64L157.99 60.64Q156.30 63.81 153.07 65.65L153.07 65.65L153.07 65.65Q149.84 67.50 144.88 67.50L144.88 67.50L144.88 67.50Q138.66 67.50 135.54 63.86L135.54 63.86L135.54 63.86Q132.43 60.22 132.36 53.26L132.36 53.26L132.36 28.76L134.26 28.76L134.26 53.33L134.26 53.33Q134.33 59.38 137.00 62.49L137.00 62.49L137.00 62.49Q139.68 65.60 144.81 65.60L144.81 65.60L144.81 65.60Q150.26 65.60 153.67 63.04L153.67 63.04L153.67 63.04Q157.08 60.47 157.99 55.51L157.99 55.51L157.99 28.76L159.93 28.76L159.93 66.80ZM200.99 47.53L200.99 48.13L200.99 48.13Q200.99 57.02 197.16 62.26L197.16 62.26L197.16 62.26Q193.32 67.50 186.71 67.50L186.71 67.50L186.71 67.50Q182.43 67.50 179.05 65.72L179.05 65.72L179.05 65.72Q175.68 63.95 173.74 60.79L173.74 60.79L173.74 66.80L171.84 66.80L171.84 12.80L173.74 12.80L173.74 35.68L173.74 35.68Q175.75 31.92 179.03 29.99L179.03 29.99L179.03 29.99Q182.32 28.05 186.64 28.05L186.64 28.05L186.64 28.05Q193.32 28.05 197.16 33.17L197.16 33.17L197.16 33.17Q200.99 38.29 200.99 47.53L200.99 47.53ZM199.02 47.39L199.02 47.39L199.02 47.39Q199.02 39.20 195.77 34.58L195.77 34.58L195.77 34.58Q192.52 29.95 186.68 29.95L186.68 29.95L186.68 29.95Q181.90 29.95 178.58 32.41L178.58 32.41L178.58 32.41Q175.25 34.88 173.74 39.73L173.74 39.73L173.74 57.16L173.74 57.16Q175.25 61.21 178.58 63.40L178.58 63.40L178.58 63.40Q181.90 65.60 186.75 65.60L186.75 65.60L186.75 65.60Q192.62 65.60 195.82 60.93L195.82 60.93L195.82 60.93Q199.02 56.25 199.02 47.39ZM262.62 66.80L249.01 44.89L231.26 44.89L231.26 66.80L229.36 66.80L229.36 15.61L245.67 15.61L245.67 15.61Q253.37 15.61 257.92 19.58L257.92 19.58L257.92 19.58Q262.48 23.55 262.48 30.38L262.48 30.38L262.48 30.38Q262.48 35.61 259.22 39.53L259.22 39.53L259.22 39.53Q255.97 43.45 250.95 44.40L250.95 44.40L264.62 66.30L264.62 66.80L262.62 66.80ZM231.26 17.51L231.26 43.00L247.39 43.00L247.39 43.00Q253.30 43.00 256.94 39.41L256.94 39.41L256.94 39.41Q260.58 35.82 260.58 30.38L260.58 30.38L260.58 30.38Q260.58 24.40 256.55 20.95L256.55 20.95L256.55 20.95Q252.53 17.51 245.53 17.51L245.53 17.51L231.26 17.51ZM289.34 67.50L289.34 67.50L289.34 67.50Q284.73 67.50 280.88 65.02L280.88 65.02L280.88 65.02Q277.03 62.54 274.85 58.22L274.85 58.22L274.85 58.22Q272.67 53.89 272.67 48.62L272.67 48.62L272.67 47.04L272.67 47.04Q272.67 41.77 274.78 37.37L274.78 37.37L274.78 37.37Q276.89 32.98 280.58 30.52L280.58 30.52L280.58 30.52Q284.27 28.05 288.63 28.05L288.63 28.05L288.63 28.05Q295.00 28.05 299.04 32.59L299.04 32.59L299.04 32.59Q303.08 37.13 303.08 44.51L303.08 44.51L303.08 46.51L274.57 46.51L274.57 48.59L274.57 48.59Q274.57 53.23 276.52 57.18L276.52 57.18L276.52 57.18Q278.47 61.14 281.90 63.39L281.90 63.39L281.90 63.39Q285.33 65.64 289.34 65.64L289.34 65.64L289.34 65.64Q293.17 65.64 295.86 64.35L295.86 64.35L295.86 64.35Q298.55 63.07 300.62 60.40L300.62 60.40L301.96 61.35L301.96 61.35Q297.70 67.50 289.34 67.50ZM288.63 29.95L288.63 29.95L288.63 29.95Q283.08 29.95 279.21 34.08L279.21 34.08L279.21 34.08Q275.34 38.21 274.68 44.61L274.68 44.61L301.18 44.61L301.18 44.16L301.18 44.16Q301.18 40.29 299.55 36.97L299.55 36.97L299.55 36.97Q297.91 33.64 295.05 31.80L295.05 31.80L295.05 31.80Q292.18 29.95 288.63 29.95ZM341.02 47.53L341.02 48.13L341.02 48.13Q341.02 57.02 337.18 62.26L337.18 62.26L337.18 62.26Q333.35 67.50 326.74 67.50L326.74 67.50L326.74 67.50Q322.42 67.50 319.04 65.74L319.04 65.74L319.04 65.74Q315.67 63.98 313.77 60.89L313.77 60.89L313.77 81.42L311.87 81.42L311.87 28.76L313.77 28.76L313.77 35.54L313.77 35.54Q315.74 31.92 319.08 29.99L319.08 29.99L319.08 29.99Q322.42 28.05 326.67 28.05L326.67 28.05L326.67 28.05Q333.35 28.05 337.18 33.17L337.18 33.17L337.18 33.17Q341.02 38.29 341.02 47.53L341.02 47.53ZM339.08 47.39L339.08 47.39L339.08 47.39Q339.08 39.20 335.83 34.58L335.83 34.58L335.83 34.58Q332.58 29.95 326.71 29.95L326.71 29.95L326.71 29.95Q321.93 29.95 318.59 32.43L318.59 32.43L318.59 32.43Q315.25 34.91 313.77 39.55L313.77 39.55L313.77 57.34L313.77 57.34Q315.25 61.28 318.60 63.44L318.60 63.44L318.60 63.44Q321.96 65.60 326.78 65.60L326.78 65.60L326.78 65.60Q332.61 65.60 335.85 60.96L335.85 60.96L335.85 60.96Q339.08 56.32 339.08 47.39ZM348.47 48.73L348.47 47.04L348.47 47.04Q348.47 41.59 350.56 37.25L350.56 37.25L350.56 37.25Q352.65 32.91 356.47 30.48L356.47 30.48L356.47 30.48Q360.28 28.05 365.10 28.05L365.10 28.05L365.10 28.05Q369.88 28.05 373.68 30.41L373.68 30.41L373.68 30.41Q377.47 32.77 379.60 37.09L379.60 37.09L379.60 37.09Q381.73 41.41 381.76 46.83L381.76 46.83L381.76 48.52L381.76 48.52Q381.76 54 379.69 58.32L379.69 58.32L379.69 58.32Q377.61 62.65 373.80 65.07L373.80 65.07L373.80 65.07Q369.98 67.50 365.17 67.50L365.17 67.50L365.17 67.50Q360.35 67.50 356.54 65.11L356.54 65.11L356.54 65.11Q352.72 62.72 350.61 58.41L350.61 58.41L350.61 58.41Q348.50 54.11 348.47 48.73L348.47 48.73ZM350.37 47.39L350.37 48.52L350.37 48.52Q350.37 53.26 352.25 57.22L352.25 57.22L352.25 57.22Q354.13 61.17 357.49 63.39L357.49 63.39L357.49 63.39Q360.84 65.60 365.17 65.60L365.17 65.60L365.17 65.60Q371.67 65.60 375.77 60.71L375.77 60.71L375.77 60.71Q379.86 55.83 379.86 48.13L379.86 48.13L379.86 47.04L379.86 47.04Q379.86 42.36 377.96 38.39L377.96 38.39L377.96 38.39Q376.07 34.42 372.71 32.19L372.71 32.19L372.71 32.19Q369.35 29.95 365.10 29.95L365.10 29.95L365.10 29.95Q358.59 29.95 354.48 34.91L354.48 34.91L354.48 34.91Q350.37 39.87 350.37 47.39L350.37 47.39ZM414.42 57.48L414.42 57.48L414.42 57.48Q414.42 50.55 402.61 48.06L402.61 48.06L402.61 48.06Q395.51 46.55 392.73 44.17L392.73 44.17L392.73 44.17Q389.95 41.80 389.95 37.65L389.95 37.65L389.95 37.65Q389.95 33.47 393.49 30.76L393.49 30.76L393.49 30.76Q397.02 28.05 402.68 28.05L402.68 28.05L402.68 28.05Q408.83 28.05 412.56 30.99L412.56 30.99L412.56 30.99Q416.29 33.93 416.29 38.92L416.29 38.92L414.35 38.92L414.35 38.92Q414.35 35.09 411.12 32.52L411.12 32.52L411.12 32.52Q407.88 29.95 402.68 29.95L402.68 29.95L402.68 29.95Q397.69 29.95 394.77 32.13L394.77 32.13L394.77 32.13Q391.85 34.31 391.85 37.58L391.85 37.58L391.85 37.58Q391.85 40.15 392.94 41.61L392.94 41.61L392.94 41.61Q394.03 43.07 396.49 44.24L396.49 44.24L396.49 44.24Q398.95 45.42 403.66 46.51L403.66 46.51L403.66 46.51Q408.38 47.60 411.12 49.08L411.12 49.08L411.12 49.08Q413.86 50.55 415.09 52.58L415.09 52.58L415.09 52.58Q416.32 54.60 416.32 57.52L416.32 57.52L416.32 57.52Q416.32 62.02 412.63 64.76L412.63 64.76L412.63 64.76Q408.94 67.50 402.96 67.50L402.96 67.50L402.96 67.50Q396.56 67.50 392.64 64.60L392.64 64.60L392.64 64.60Q388.72 61.70 388.72 57.13L388.72 57.13L390.62 57.13L390.62 57.13Q390.90 61.14 394.15 63.37L394.15 63.37L394.15 63.37Q397.41 65.60 402.96 65.60L402.96 65.60L402.96 65.60Q408.06 65.60 411.24 63.23L411.24 63.23L411.24 63.23Q414.42 60.86 414.42 57.48Z'}/></svg>
          </h2>
          <section className={'github-repositories-container'}>
            {repositoryEntries}
          </section>
        </section>
      )} />
    );
  }
}
